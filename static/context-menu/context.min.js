class ContextMenu{constructor(container,items){this.container=container,this.dom=null,this.shown=!1,this.root=!0,this.parent=null,this.submenus=[],this.items=items,this.nodes=[],this._onclick=e=>{!e.target.parentElement||!this.dom||e.target==this.dom||e.target.parentElement==this.dom||e.target.classList.contains("item")||e.target.parentElement.classList.contains("item")||this.hideAll()},this._oncontextmenu=e=>{e.target.parentElement&&(e.preventDefault(),e.target==this.dom||e.target.parentElement==this.dom||e.target.classList.contains("item")||e.target.parentElement.classList.contains("item")||(this.hideAll(),this.nodes=document.elementsFromPoint(e.clientX,e.clientY),this.show(e.clientX,e.clientY)))},this._oncontextmenu_keydown=e=>{93==e.keyCode&&(e.preventDefault(),this.hideAll(),this.show(e.clientX,e.clientY))},this._onblur=e=>{this.hideAll()}}getMenuDom(){var menu=document.createElement("div");menu.classList.add("context");for(const item of this.items)menu.appendChild(this.itemToDomEl(item));return menu}itemToDomEl(data){const item=document.createElement("div");if(null===data)item.classList="separator";else{data.hasOwnProperty("color")&&/^#([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(data.color.toString())&&(item.style.cssText="color: "+data.color),item.classList.add("item");const label=document.createElement("span"),hotkey=(label.classList="label",label.innerText=data.hasOwnProperty("text")?data.text.toString():"",item.appendChild(label),data.hasOwnProperty("disabled")&&data.disabled?item.classList.add("disabled"):item.classList.add("enabled"),document.createElement("span"));if(hotkey.classList="hotkey",hotkey.innerText=data.hasOwnProperty("hotkey")?data.hotkey.toString():"",item.appendChild(hotkey),data.hasOwnProperty("subitems")&&Array.isArray(data.subitems)&&0<data.subitems.length){const menu=new ContextMenu(this.container,data.subitems);menu.root=!1;var openSubItems=e=>{var x,y;data.hasOwnProperty("disabled")&&1==data.disabled||(this.hideSubMenus(),x=this.dom.offsetLeft+this.dom.clientWidth+item.offsetLeft,y=this.dom.offsetTop+item.offsetTop,menu.shown?menu.hide():menu.show(x,y))};(menu.parent=this).submenus.push(menu),item.classList.add("has-subitems"),item.addEventListener("click",openSubItems),item.addEventListener("mousemove",openSubItems)}else if(data.hasOwnProperty("submenu")&&data.submenu instanceof ContextMenu){const menu=data.submenu,openSubItems=(menu.root=!1,e=>{var x,y;data.hasOwnProperty("disabled")&&1==data.disabled||(this.hideSubMenus(),x=this.dom.offsetLeft+this.dom.clientWidth+item.offsetLeft,y=this.dom.offsetTop+item.offsetTop,menu.shown?menu.hide():menu.show(x,y))});(menu.parent=this).submenus.push(menu),item.classList.add("has-subitems"),item.addEventListener("click",openSubItems),item.addEventListener("mousemove",openSubItems)}else item.addEventListener("click",e=>{var event;this.hideSubMenus(),item.classList.contains("disabled")||data.hasOwnProperty("onclick")&&"function"==typeof data.onclick&&(event={handled:!1,item:item,label:label,hotkey:hotkey,items:this.items,data:data,nodes:this.nodes},data.onclick(event),event.handled)||this.hide()}),item.addEventListener("mousemove",e=>{this.hideSubMenus()})}return item}hideAll(){(!this.root||this.parent||this.shown&&(this.hideSubMenus(),this.shown=!1,this.container.removeChild(this.dom),this.parent)&&this.parent.shown)&&this.parent.hide()}hide(){this.dom&&this.shown&&(this.shown=!1,this.hideSubMenus(),this.container.removeChild(this.dom),this.nodes=[],this.parent)&&this.parent.shown&&this.parent.hide()}hideSubMenus(){for(const menu of this.submenus)menu.shown&&(menu.shown=!1,menu.container.removeChild(menu.dom)),menu.hideSubMenus()}show(x,y){this.dom=this.getMenuDom(),this.dom.style.left=x+"px",this.dom.style.top=y+"px",this.shown=!0,this.container.appendChild(this.dom)}install(){this.container.addEventListener("contextmenu",this._oncontextmenu),this.container.addEventListener("keydown",this._oncontextmenu_keydown),this.container.addEventListener("click",this._onclick),window.addEventListener("blur",this._onblur)}uninstall(){this.dom=null,this.container.removeEventListener("contextmenu",this._oncontextmenu),this.container.removeEventListener("keydown",this._oncontextmenu_keydown),this.container.removeEventListener("click",this._onclick),window.removeEventListener("blur",this._onblur)}}